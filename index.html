<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Google Drive Explorer</title>

<script src="https://accounts.google.com/gsi/client"></script>
<script src="https://apis.google.com/js/api.js"></script>

<style>
body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background:#f4f4f9; margin:0; padding:0; }
header { background: #1a73e8; color: white; padding:15px; text-align:center; font-size:24px; font-weight:bold; }
.container { max-width:900px; margin:20px auto; padding:10px; }
.buttons { margin-bottom:20px; }
button { background:#1a73e8; color:white; border:none; padding:10px 18px; border-radius:5px; margin-right:10px; cursor:pointer; font-size:16px; }
button:hover { background:#155bb5; }
.file-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(160px,1fr)); gap:15px; }
.card { background:white; padding:12px; border-radius:8px; box-shadow:0px 2px 5px rgba(0,0,0,0.1); text-align:center; cursor:pointer; transition: transform 0.2s, box-shadow 0.2s; }
.card:hover { transform:translateY(-5px); box-shadow:0px 6px 15px rgba(0,0,0,0.2); }
.folder-icon { font-size:40px; color:#fbbc04; }
.file-icon { font-size:40px; color:#34a853; }
.filename { margin-top:10px; font-weight:500; word-break:break-word; }
</style>
</head>

<body>

<header>üìÅ Google Drive Explorer</header>

<div class="container">
    <div class="buttons">
        <button id="loginBtn" onclick="login()">Sign In</button>
        <button id="logoutBtn" onclick="logout()" style="display:none;">Sign Out</button>
        <button onclick="goBack()">üîô Go Back</button>
    </div>

    <div id="files" class="file-grid"></div>
</div>

<script>
const CLIENT_ID = "418351745250-ik2vhfn07obkjl90o4r30f6ost6qduda.apps.googleusercontent.com";
const SCOPES = "https://www.googleapis.com/auth/drive.readonly";

let folderStack = ["root"];
let tokenClient = null;

// Load GAPI
function gapiLoaded() {
    gapi.load("client", async () => {
        await gapi.client.init({
            discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"]
        });

        // Check if token exists in localStorage
        const savedToken = localStorage.getItem("gdrive_token");
        if (savedToken) {
            gapi.client.setToken({ access_token: savedToken });
            loadFolder("root");
            document.getElementById("loginBtn").style.display = "none";
            document.getElementById("logoutBtn").style.display = "inline-block";
        }
    });
}

// Sign in
function login() {
    tokenClient = google.accounts.oauth2.initTokenClient({
        client_id: CLIENT_ID,
        scope: SCOPES,
        callback: (resp) => {
            if (resp.access_token) {
                localStorage.setItem("gdrive_token", resp.access_token); // Save token
                loadFolder("root");
                document.getElementById("loginBtn").style.display = "none";
                document.getElementById("logoutBtn").style.display = "inline-block";
            }
        }
    });
    tokenClient.requestAccessToken();
}

// Sign out
function logout() {
    localStorage.removeItem("gdrive_token");
    location.reload();
}

// Load folder content
async function loadFolder(folderId) {
    try {
        const res = await gapi.client.drive.files.list({
            q: `'${folderId}' in parents and trashed = false`,
            fields: "files(id, name, mimeType)"
        });

        const container = document.getElementById("files");
        container.innerHTML = "";

        res.result.files.forEach(file => {
            const card = document.createElement("div");
            card.className = "card";

            const icon = document.createElement("div");
            icon.className = file.mimeType === "application/vnd.google-apps.folder" ? "folder-icon" : "file-icon";
            icon.textContent = file.mimeType === "application/vnd.google-apps.folder" ? "üìÅ" : "üìÑ";

            const name = document.createElement("div");
            name.className = "filename";
            name.textContent = file.name;

            card.appendChild(icon);
            card.appendChild(name);

            if (file.mimeType === "application/vnd.google-apps.folder") {
                card.onclick = () => {
                    folderStack.push(file.id);
                    loadFolder(file.id);
                };
            } else {
                card.onclick = () => {
                    const url = `https://drive.google.com/file/d/${file.id}/view`;
                    window.open(url, "_blank");
                };
            }

            container.appendChild(card);
        });

    } catch (error) {
        console.error("Error loading files:", error);
        alert("Error loading files. Please make sure you are signed in correctly.");
    }
}

// Go back button
function goBack() {
    if (folderStack.length > 1) {
        folderStack.pop();
        loadFolder(folderStack[folderStack.length - 1]);
    }
}

// Initialize
gapiLoaded();
</script>

</body>
</html>
