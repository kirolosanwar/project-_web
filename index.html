<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Google Drive Data Visualization</title>

<!-- Google APIs -->
<script src="https://accounts.google.com/gsi/client"></script>
<script src="https://apis.google.com/js/api.js"></script>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- CSV Parser -->
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
body {
    font-family: Arial, sans-serif;
    background: #f4f6f8;
    padding: 20px;
}
button {
    padding: 10px 15px;
    margin: 5px;
    cursor: pointer;
}
#files {
    margin-top: 20px;
}
canvas {
    background: white;
    padding: 20px;
}
</style>
</head>

<body>

<h2>Google Drive Data Visualization</h2>

<button onclick="login()">Login with Google</button>
<button onclick="loadFiles()">Load Files</button>

<div id="files"></div>

<canvas id="chart" width="600" height="300"></canvas>

<script>
const CLIENT_ID = "418351745250-48015ia9v4rimop44nm3dshqmjr19c1o.apps.googleusercontent.com";
const API_KEY = "YOUR_API_KEY";

const SCOPES = "https://www.googleapis.com/auth/drive.readonly";

let tokenClient;
let gapiInited = false;
let gisInited = false;

// Load Google API
gapi.load("client", async () => {
    await gapi.client.init({
        apiKey: API_KEY,
        discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"],
    });
    gapiInited = true;
});

// OAuth
tokenClient = google.accounts.oauth2.initTokenClient({
    client_id: CLIENT_ID,
    scope: SCOPES,
    callback: () => {}
});

function login() {
    tokenClient.requestAccessToken({ prompt: "consent" });
}

// Load files from Drive
async function loadFiles() {
    const res = await gapi.client.drive.files.list({
        q: "mimeType='text/csv'",
        fields: "files(id, name)"
    });

    const filesDiv = document.getElementById("files");
    filesDiv.innerHTML = "";

    res.result.files.forEach(file => {
        const btn = document.createElement("button");
        btn.innerText = file.name;
        btn.onclick = () => loadCSV(file.id);
        filesDiv.appendChild(btn);
    });
}

// Load CSV file
async function loadCSV(fileId) {
    const res = await gapi.client.drive.files.get({
        fileId: fileId,
        alt: "media"
    });

    Papa.parse(res.body, {
        header: true,
        complete: function(results) {
            drawChart(results.data);
        }
    });
}

// Draw Chart
function drawChart(data) {
    const labels = data.map(row => row[Object.keys(row)[0]]);
    const values = data.map(row => Number(row[Object.keys(row)[1]]));

    new Chart(document.getElementById("chart"), {
        type: "bar",
        data: {
            labels: labels,
            datasets: [{
                label: "Values",
                data: values
            }]
        }
    });
}
</script>

</body>
</html>

